{"version":3,"sources":["webpack:///./src/app/core/services/reward-request.service.ts","webpack:///./src/app/pages/tabs/profile/rewards-catalog/reward-details/reward-details.module.ts","webpack:///./src/app/pages/tabs/profile/rewards-catalog/reward-details/reward-details.page.html","webpack:///./src/app/pages/tabs/profile/rewards-catalog/reward-details/reward-details.page.scss","webpack:///./src/app/pages/tabs/profile/rewards-catalog/reward-details/reward-details.page.ts"],"names":[],"mappings":"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","file":"pages-tabs-profile-rewards-catalog-reward-details-reward-details-module.js","sourcesContent":["import { Injectable } from '@angular/core';\nimport {AngularFireDatabase} from '@angular/fire/database';\nimport {Request} from '../../shared/models/Request';\nimport {RewardRequest} from '../../shared/models/RewardRequest';\nimport {Observable} from 'rxjs';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class RewardRequestService {\n\n  private collectionEndPoint = 'rewardRequests';\n\n  constructor(private db: AngularFireDatabase) {\n  }\n\n  public createRequest(request: RewardRequest): Promise<void> {\n    request.id = this.db.createPushId();\n    return this.db.object<RewardRequest>(`${this.collectionEndPoint}/${request.id}`).set(request);\n  }\n\n  public updateRequest(request: RewardRequest): Promise<void> {\n    return this.db.object<RewardRequest>(`${this.collectionEndPoint}/${request.id}`).update(request);\n  }\n\n  public getRequests(): Observable<RewardRequest[]> {\n    return this.db.list<RewardRequest>(this.collectionEndPoint).valueChanges();\n  }\n\n  public getRequestsByRewardId(rewardId: string): Observable<RewardRequest[]> {\n    return this.db.list<RewardRequest>(this.collectionEndPoint, ref => ref.orderByChild('rewardId').equalTo(rewardId)).valueChanges();\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { RewardDetailsPage } from './reward-details.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: RewardDetailsPage\n  }\n];\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    RouterModule.forChild(routes)\n  ],\n  declarations: [RewardDetailsPage]\n})\nexport class RewardDetailsPageModule {}\n","module.exports = \"<ion-header>\\n    <ion-toolbar color=\\\"primary\\\">\\n        <ion-title>Reward Details</ion-title>\\n        <ion-buttons slot=\\\"start\\\">\\n            <ion-back-button></ion-back-button>\\n        </ion-buttons>\\n    </ion-toolbar>\\n</ion-header>\\n\\n<ion-content>\\n    <ion-card>\\n        <div class=\\\"reward-photo\\\" padding-top>\\n            <ion-avatar>\\n                <img [src]=\\\"reward.photo\\\">\\n            </ion-avatar>\\n        </div>\\n\\n\\n        <div text-center>\\n            <h2>{{reward.name}}*</h2>\\n            <h3>-{{reward.points}} pts</h3>\\n        </div>\\n        <div>\\n            <ion-label>Description: {{reward.description}}</ion-label>\\n            <p>*Hasta fin de existencias</p>\\n        </div>\\n\\n        <div text-center>\\n            <ion-button (click)=\\\"exchange()\\\" [disabled]=\\\"currentUser.points.currentPoints < reward.points\\\">\\n                Canjear con {{reward.points}} pts\\n            </ion-button>\\n        </div>\\n    </ion-card>\\n\\n\\n    <ion-list *ngIf=\\\"requests\\\">\\n        <ion-list-header>Requests</ion-list-header>\\n        <ion-item-sliding *ngFor=\\\"let request of requests\\\">\\n            <ion-item>\\n                <ion-avatar slot=\\\"start\\\" (click)=\\\"goToUserDetailsPage(request.userId)\\\">\\n                    <img [src]=\\\"request.user?.photo\\\">\\n                </ion-avatar>\\n                <ion-label>\\n                    <h3>{{request.user?.name}}</h3>\\n                    <label> <a> Status: </a>{{request.state}}</label>\\n                </ion-label>\\n            </ion-item>\\n            <ion-item-options side=\\\"end\\\">\\n                <ion-item-option color=\\\"success\\\" (click)=\\\"acceptRequest(request, request.user)\\\"\\n                                 [disabled]=\\\"request.state == 'ACCEPTED'\\\">\\n                    <ion-icon slot=\\\"icon-only\\\" name=\\\"checkmark-circle-outline\\\"></ion-icon>\\n                </ion-item-option>\\n                <ion-item-option color=\\\"danger\\\" (click)=\\\"refuseRequest(request)\\\"\\n                                 [disabled]=\\\"request.state == 'REFUSED'\\\">\\n                    <ion-icon slot=\\\"icon-only\\\" name=\\\"close-circle-outline\\\"></ion-icon>\\n                </ion-item-option>\\n            </ion-item-options>\\n        </ion-item-sliding>\\n    </ion-list>\\n\\n</ion-content>\\n\"","module.exports = \"ion-card {\\n  padding: 10px; }\\n  ion-card .reward-photo ion-avatar {\\n    margin: 0 auto;\\n    width: 200px;\\n    height: 200px; }\\n  .request-button {\\n  font-size: 20px; }\\n\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9tb25leWJhL0Rlc2t0b3AvdW50aXRsZWQgZm9sZGVyL3RmbS9zcmMvYXBwL3BhZ2VzL3RhYnMvcHJvZmlsZS9yZXdhcmRzLWNhdGFsb2cvcmV3YXJkLWRldGFpbHMvcmV3YXJkLWRldGFpbHMucGFnZS5zY3NzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0VBQ0UsYUFBYSxFQUFBO0VBRGY7SUFJSSxjQUFjO0lBQ2QsWUFBWTtJQUNaLGFBQWEsRUFBQTtFQUlqQjtFQUNFLGVBQWUsRUFBQSIsImZpbGUiOiJzcmMvYXBwL3BhZ2VzL3RhYnMvcHJvZmlsZS9yZXdhcmRzLWNhdGFsb2cvcmV3YXJkLWRldGFpbHMvcmV3YXJkLWRldGFpbHMucGFnZS5zY3NzIiwic291cmNlc0NvbnRlbnQiOlsiaW9uLWNhcmQge1xuICBwYWRkaW5nOiAxMHB4O1xuXG4gIC5yZXdhcmQtcGhvdG8gaW9uLWF2YXRhciB7XG4gICAgbWFyZ2luOiAwIGF1dG87XG4gICAgd2lkdGg6IDIwMHB4O1xuICAgIGhlaWdodDogMjAwcHg7XG4gIH1cblxufVxuLnJlcXVlc3QtYnV0dG9uIHtcbiAgZm9udC1zaXplOiAyMHB4O1xufVxuIl19 */\"","import { Component, OnInit } from '@angular/core';\nimport {ActivatedRoute, NavigationExtras, Router} from '@angular/router';\nimport {RewardProduct} from '../../../../../shared/models/RewardProduct';\nimport {User} from '../../../../../shared/models/User';\nimport {UserService} from '../../../../../core/services/user.service';\nimport {RewardRequestService} from '../../../../../core/services/reward-request.service';\nimport {RewardRequest} from '../../../../../shared/models/RewardRequest';\nimport {State} from '../../../../../shared/ui.utils';\nimport {Request} from '../../../../../shared/models/Request';\nimport {RewardService} from '../../../../../core/services/reward.service';\n\n@Component({\n  selector: 'app-reward-details',\n  templateUrl: './reward-details.page.html',\n  styleUrls: ['./reward-details.page.scss'],\n})\nexport class RewardDetailsPage implements OnInit {\n  public reward: RewardProduct;\n  public requests: any[];\n  private currentUser: User;\n\n  constructor(private route: ActivatedRoute,\n              private router: Router,\n              private userService: UserService,\n              private rewardService: RewardService,\n              private rewardRequestService: RewardRequestService) {\n    this.route.queryParams.subscribe(params => {\n\n      if (this.router.getCurrentNavigation().extras.state) {\n        this.reward = this.router.getCurrentNavigation().extras.state.reward;\n        this.currentUser = this.router.getCurrentNavigation().extras.state.user;\n      }\n    });\n  }\n\n  ngOnInit() {\n    this.getRequests();\n  }\n\n  public exchange(): void {\n    this.currentUser.points.currentPoints -= this.reward.points;\n    this.currentUser.points.blockedPoints = this.reward.points;\n    this.createRequest();\n    this.userService.updateUser(this.currentUser);\n  }\n\n  private createRequest(): void {\n    const request: RewardRequest = {\n      dateTime: new Date().getTime(),\n      rewardId: this.reward.id,\n      userId: this.currentUser.id,\n      state: State.pending\n    };\n    this.rewardRequestService.createRequest(request).then(() =>\n        this.router.navigate(['rewards-catalog'])\n    );\n  }\n\n  public getRequests(): void {\n    this.rewardRequestService.getRequestsByRewardId(this.reward.id).subscribe(requests => {\n          this.requests = requests;\n          requests.forEach((request, index) => this.getUser(request.userId, index));\n          console.log(requests);\n        }\n    );\n  }\n\n  public getUser(userId, index): void {\n    console.log(userId);\n    this.userService.getUser(userId).subscribe(user => this.requests[index].user = user);\n  }\n\n  public goToUserDetailsPage(userId: string): void {\n    const navigationExtras: NavigationExtras = {\n      state: {\n        userId\n      }\n    };\n    this.router.navigate(['public-profile'], navigationExtras);\n  }\n\n  public acceptRequest(request: RewardRequest, user: User): void {\n    if (this.reward.stock > 0) {\n      request.state = State.accepted;\n      this.reward.stock--;\n      user.points.exchangedPoints += this.reward.points;\n      user.points.blockedPoints -= this.reward.points;\n      this.rewardRequestService.updateRequest(request);\n      this.rewardService.updateReward(this.reward);\n      this.userService.updateUser(user).then(() => this.getRequests());\n\n    }\n  }\n\n  public refuseRequest(request: RewardRequest): void {\n    request.state = State.refused;\n    this.rewardRequestService.updateRequest(request);\n  }\n\n}\n"],"sourceRoot":""}